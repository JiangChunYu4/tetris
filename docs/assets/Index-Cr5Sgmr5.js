import{r as y,a as u,o as be,w as we,b as ke,c as k,d as C,e as r,F as te,f as ae,t as T,n as oe,g as Ce,p as De,h as Ie}from"./index-YLHfhwRK.js";const Be={lineGradientLigthTheme:["linear-gradient(180deg, #FFA7EB 0%, #F026A8 100%)","linear-gradient(180deg, #DFA1FF 0%, #9A36F0 100%)","linear-gradient(180deg, #9EAAFF 0%, #3846F4 100%)","linear-gradient(180deg, #7BE7FF 0%, #1E85E2 100%)","linear-gradient(180deg, #89FED8 0%, #18C997 100%)","linear-gradient(180deg, #FFED48 0%, #FD9E16 100%)","linear-gradient(180deg, #FFBA8D 0%, #EB6423 100%)"],normalLightTheme:["#2B7AF5","#2B9DF5","#79CFFF","#1B67DD","#4F94FF","#2180F2","#3FD0FF"]},ne=[[0,1,0,2,1,2,2,2],[0,1,1,1,1,2,2,2],[1,1,1,2,2,1,2,2],[1,0,1,1,1,2,1,3],[0,2,1,1,1,2,2,1],[0,1,0,2,1,1,2,1],[1,1,2,0,2,1,2,2]],M=[[{x:1,y:1},{x:1,y:0},{x:0,y:-2},{x:-2,y:1}],[{x:1,y:1},{x:1,y:0},{x:0,y:-2},{x:-2,y:1}],[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}],[{x:-1,y:2},{x:1,y:1},{x:2,y:-1},{x:-2,y:-2}],[{x:2,y:0},{x:0,y:-1},{x:-1,y:-1},{x:-1,y:2}],[{x:1,y:1},{x:1,y:0},{x:0,y:-2},{x:-2,y:1}],[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:0}]],se=(g,n)=>{n.splice(0,n.length);for(let v=0;v<ne.length;v++){const m={position:ne[v],color:Be[g][v]};n.push(m)}},p=(g,n,v)=>g*v+n,Me=(g,n)=>{const v=g.__vccOpts||g;for(const[m,l]of n)v[m]=l;return v},G=g=>(De("data-v-43323b9b"),g=g(),Ie(),g),Oe={class:"game-container"},Se={class:"game-left"},Le={class:"main-frame"},Re={key:0,class:"game-over"},Ae={class:"operation-box"},Ee={class:"game-right"},Te={class:"sub-frame"},Ge={class:"data-box"},Ne={class:"data-row"},Je=G(()=>r("div",{class:"data-label"},"清除次数:",-1)),je={class:"data"},Pe={class:"data-row"},Ue=G(()=>r("div",{class:"data-label"},"等级:",-1)),Ve={class:"data"},ze={class:"data-row"},Ke=G(()=>r("div",{class:"data-label"},"分数:",-1)),qe={class:"data"},He={class:"data-row"},Qe=G(()=>r("div",{class:"data-label"},"速度:",-1)),We={class:"data"},Xe={class:"system-box"},Ye={__name:"Index",setup(g){const n=y([]),v=y([]),m=u(20),l=u(10),le=u(4),N=u(4),O=u("#eeeeee"),S=u("lineGradientLigthTheme"),I=y([]),f=y({index:0,transform:0}),D=y({index:0,transform:0});let s=y({}),A=y({}),h=null;const _=y([]),V=u(800),B=u(V.value),z=u(100),re=u(40),F=u(!1),b=u(!1),K=u(0),L=u(1),J=u(0),ie=u(5),ce=()=>{for(let e=0;e<m.value;e++)for(let t=0;t<l.value;t++)n.push(y({data:0,bgColor:O.value}))},de=()=>{for(let e=0;e<le.value;e++)for(let t=0;t<N.value;t++)v.push(y({data:0,bgColor:O.value}))},x=(e,t,a,o)=>{const i=e.position;for(let c=0;c<i.length;c+=2)switch(o){case"clear":t[p(i[c],i[c+1],a)].bgColor=O.value;break;case"generate":t[p(i[c],i[c+1],a)].bgColor=e.color;break;case"fix":t[p(i[c],i[c+1],a)].data=1;break}},q=()=>{let e=Math.floor(Math.random()*I.length);for(;e===D.index;)e=Math.floor(Math.random()*I.length);D.index=e,D.transform=Math.floor(Math.random()*4)},H=()=>{f.index=D.index,f.transform=D.transform,s=JSON.parse(JSON.stringify(I[f.index])),Y(s,n,l.value,f),q(),A.position&&x(A,v,N.value,"clear"),A=JSON.parse(JSON.stringify(I[D.index])),Y(A,v,N.value,D)},ue=()=>{const e=s.position;for(let t=0;t<e.length;t+=2){if(e[t]>=m.value-1)return!1;const a=p(e[t]+1,e[t+1],l.value);if(n[a].data>0)return!1}return!0},ve=()=>{const e=s.position;for(let t=0;t<e.length;t+=2){const a=p(e[t],e[t+1]-1,l.value);if(e[t+1]<=0||n[a].data>0)return!1}return!0},fe=()=>{const e=s.position;for(let t=0;t<e.length;t+=2){const a=p(e[t],e[t+1]+1,l.value);if(e[t+1]>=l.value-1||n[a].data>0)return!1}return!0},he=()=>{const e=JSON.parse(JSON.stringify(s)),t=f.transform,a=f.index,o=e.position,i=o[0],c=o[1];for(let d=0;d<o.length;d+=2){const w=o[d]-i,j=o[d+1]-c,P=i+M[a][t].x,U=c+M[a][t].y;if(o[d]=j+P,o[d+1]=-w+U,o[d+1]<0||o[d+1]>=l.value||o[d]>=m.value||n[p(o[d],o[d+1],l.value)].data>0)return!1}return!0},R=()=>{if(!(b.value||!F.value))if(ue()){x(s,n,l.value,"clear");for(let e=0;e<s.position.length;e+=2)s.position[e]++;x(s,n,l.value,"generate")}else x(s,n,l.value,"fix"),pe()},Q=()=>{if(!(b.value||!F.value)&&ve()){x(s,n,l.value,"clear");for(let e=0;e<s.position.length;e+=2)s.position[e+1]--;x(s,n,l.value,"generate")}},W=()=>{if(!(b.value||!F.value)&&fe()){x(s,n,l.value,"clear");for(let e=0;e<s.position.length;e+=2)s.position[e+1]++;x(s,n,l.value,"generate")}},X=()=>{if(!(b.value||!F.value)&&he()){x(s,n,l.value,"clear");const e=s.position[0],t=s.position[1];for(let a=0;a<s.position.length;a+=2){const o=s.position[a]-e,i=s.position[a+1]-t,c=e+M[f.index][f.transform].x,d=t+M[f.index][f.transform].y;s.position[a]=i+c,s.position[a+1]=-o+d}f.transform=(f.transform+1)%4,x(s,n,l.value,"generate")}},Y=(e,t,a,o)=>{x(e,t,a,"clear");for(let i=0;i<o.transform;i++){const c=e.position[0],d=e.position[1];for(let w=0;w<e.position.length;w+=2){const j=e.position[w]-c,P=e.position[w+1]-d,U=c+M[o.index][i].x,Fe=d+M[o.index][i].y;e.position[w]=P+U,e.position[w+1]=-j+Fe}}x(e,t,a,"generate")},xe=e=>{K.value+=e*(e+1)/2*100*L.value},ge=()=>{J.value++,L.value=Math.max(L.value,Math.floor(J.value/ie.value)+1),B.value=V.value-(L.value-1)*re.value,B.value=Math.max(B.value,z.value),Z()},pe=()=>{let e=0;for(let t=m.value-1;t>=0;t--){let a=0;for(let o=0;o<l.value;o++)n[p(t,o,l.value)].data>0&&a++;if(a===0)break;a===l.value&&_.push(t),e++}if(e>=m.value-1){E(),b.value=!0;return}if(_.length>0){for(let t=0;t<_.length;t++)for(let a=0;a<l.value;a++){const o=p(_[t],a,l.value);n[o].bgColor=O.value,n[o].data=0}for(let t=m.value-1;t>=0;t--){let a=0;for(;_[a]>t;)a++;if(a>0)for(let o=0;o<l.value;o++){const i=p(t,o,l.value);if(n[i].data>0){const c=p(t+a,o,l.value);n[c].data=n[i].data,n[c].bgColor=n[i].bgColor,n[i].data=0,n[i].bgColor=O.value}}}xe(_.length),ge(),_.splice(0,_.length)}H()},Z=()=>{b.value||(F.value=!0,h&&clearInterval(h),h=setInterval(()=>{R()},B.value))},E=()=>{b.value||(F.value?(F.value=!1,clearInterval(h)):Z())},$=()=>{S.value==="lineGradientLigthTheme"?S.value="normalLightTheme":S.value="lineGradientLigthTheme"},me=e=>{e.preventDefault(),h&&clearInterval(h),h=setInterval(()=>{R()},z.value)},ye=e=>{e.preventDefault(),h&&clearInterval(h),h=setInterval(()=>{R()},B.value)},_e=()=>{ce(),de()},ee=e=>{switch(e.key){case"ArrowUp":X();break;case"ArrowDown":R();break;case"ArrowLeft":Q();break;case"ArrowRight":W();break;case"Enter":E();break;case"t":$();break}};return be(()=>{window.addEventListener("keydown",ee),_e(),se(S.value,I),q(),H(),we(S,e=>{se(e,I)})}),ke(()=>{window.removeEventListener("keydown",ee),h&&clearInterval(h)}),(e,t)=>(k(),C("div",Oe,[r("div",Se,[r("div",Le,[(k(!0),C(te,null,ae(n,(a,o)=>(k(),C("div",{key:o,class:"cell",style:oe({background:a.bgColor})},[b.value?(k(),C("div",Re,"Game Over")):Ce("",!0)],4))),128))]),r("div",Ae,[r("div",{class:"rotate btn",onClick:X},"旋转"),r("div",{class:"btn",onClick:Q},"向左"),r("div",{class:"btn",onClick:W},"向右"),r("div",{class:"move-down btn",onClick:R,onTouchstart:me,onTouchend:ye}," 向下 ",32)])]),r("div",Ee,[r("div",Te,[(k(!0),C(te,null,ae(v,(a,o)=>(k(),C("div",{key:o,class:"cell",style:oe({background:a.bgColor})},null,4))),128))]),r("div",Ge,[r("div",Ne,[Je,r("div",je,T(J.value),1)]),r("div",Pe,[Ue,r("div",Ve,T(L.value),1)]),r("div",ze,[Ke,r("div",qe,T(K.value),1)]),r("div",He,[Qe,r("div",We,T(B.value),1)])]),r("div",Xe,[F.value?(k(),C("div",{key:0,class:"btn",onClick:E},"暂停")):(k(),C("div",{key:1,class:"btn",onClick:E},"开始")),r("div",{class:"btn",onClick:$},"切换主题")])])]))}},$e=Me(Ye,[["__scopeId","data-v-43323b9b"]]);export{$e as default};
