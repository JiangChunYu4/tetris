import{r as b,a as u,o as Ee,w as le,b as Be,c as w,d as k,e as r,F as re,f as ie,t as G,n as Me,g as ce,h as Ie}from"./index-CdWVm2VK.js";const Oe={lineGradientLigthTheme:["linear-gradient(180deg, #FFA7EB 0%, #F026A8 100%)","linear-gradient(180deg, #DFA1FF 0%, #9A36F0 100%)","linear-gradient(180deg, #9EAAFF 0%, #3846F4 100%)","linear-gradient(180deg, #7BE7FF 0%, #1E85E2 100%)","linear-gradient(180deg, #89FED8 0%, #18C997 100%)","linear-gradient(180deg, #FFED48 0%, #FD9E16 100%)","linear-gradient(180deg, #FFBA8D 0%, #EB6423 100%)"],normalLightTheme:["#2B7AF5","#2B9DF5","#79CFFF","#1B67DD","#4F94FF","#2180F2","#3FD0FF"]},ue=[[0,1,0,2,1,2,2,2],[0,1,1,1,1,2,2,2],[1,1,1,2,2,1,2,2],[1,0,1,1,1,2,1,3],[0,2,1,1,1,2,2,1],[0,1,0,2,1,1,2,1],[1,1,2,0,2,1,2,2]],O=[[{x:1,y:1},{x:1,y:0},{x:0,y:-2},{x:-2,y:1}],[{x:1,y:1},{x:1,y:0},{x:0,y:-2},{x:-2,y:1}],[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}],[{x:-1,y:2},{x:1,y:1},{x:2,y:-1},{x:-2,y:-2}],[{x:2,y:0},{x:0,y:-1},{x:-1,y:-1},{x:-1,y:2}],[{x:1,y:1},{x:1,y:0},{x:0,y:-2},{x:-2,y:1}],[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:0}]],ve=(C,n)=>{n.splice(0,n.length);for(let d=0;d<ue.length;d++){const m={position:ue[d],color:Oe[C][d]};n.push(m)}},h=(C,n,d)=>C*d+n,Le=(C,n)=>{const d=C.__vccOpts||C;for(const[m,s]of n)d[m]=s;return d},Se={class:"game-container"},Ae={class:"game-left"},Ge={class:"main-frame"},Ne={key:0,class:"game-over"},je={class:"operation-box"},Je={class:"game-right"},Pe={class:"sub-frame"},Ue={class:"data-box"},ze={class:"data-row"},Ve={class:"data"},Ke={class:"data-row"},$e={class:"data"},qe={class:"data-row"},He={class:"data"},Qe={class:"data-row"},We={class:"data"},Xe={class:"data-row"},Ye={class:"data"},Ze={class:"system-box"},et={__name:"Index",setup(C){const n=b([]),d=b([]),m=u(24),s=u(10),U=u(4),z=u(4),T=u("#eeeeee"),L=u("lineGradientLigthTheme"),E=b([]),f=b({index:0,transform:0}),D=b({index:0,transform:0});let l=b({}),N=b({});const _=u(null),p=b([]),V=u(800),R=u(V.value),W=u(100),de=u(40),K=u(3),x=u(!1),y=u(!1),S=u(0),B=u(1),j=u(0),fe=u(5),M=u(0),ge=()=>{for(let e=0;e<m.value;e++)for(let t=0;t<s.value;t++)n.push(b({data:0,bgColor:T.value}))},he=()=>{for(let e=0;e<U.value;e++)for(let t=0;t<z.value;t++)d.push(b({data:0,bgColor:T.value}))},g=(e,t,a,o)=>{const i=e.position;for(let c=0;c<i.length;c+=2)switch(o){case"clear":t[h(i[c],i[c+1],a)].bgColor=T.value;break;case"generate":t[h(i[c],i[c+1],a)].bgColor=e.color;break;case"fix":t[h(i[c],i[c+1],a)].data=1;break}},$=()=>{let e=Math.floor(Math.random()*E.length);for(;e===D.index;)e=Math.floor(Math.random()*E.length);D.index=e,D.transform=Math.floor(Math.random()*4)},J=()=>{f.index=D.index,f.transform=D.transform,l=JSON.parse(JSON.stringify(E[f.index])),ee(l,n,s.value,f),$(),N.position&&g(N,d,z.value,"clear"),N=JSON.parse(JSON.stringify(E[D.index])),ee(N,d,z.value,D)},xe=()=>{const e=l.position;for(let t=0;t<e.length;t+=2){if(e[t]>=m.value-1)return!1;const a=h(e[t]+1,e[t+1],s.value);if(n[a].data>0)return!1}return!0},me=()=>{const e=l.position;for(let t=0;t<e.length;t+=2){const a=h(e[t],e[t+1]-1,s.value);if(e[t+1]<=0||n[a].data>0)return!1}return!0},pe=()=>{const e=l.position;for(let t=0;t<e.length;t+=2){const a=h(e[t],e[t+1]+1,s.value);if(e[t+1]>=s.value-1||n[a].data>0)return!1}return!0},ye=()=>{const e=JSON.parse(JSON.stringify(l)),t=f.transform,a=f.index,o=e.position,i=o[0],c=o[1];for(let v=0;v<o.length;v+=2){const F=o[v]-i,q=o[v+1]-c,H=i+O[a][t].x,Q=c+O[a][t].y;if(o[v]=q+H,o[v+1]=-F+Q,o[v+1]<0||o[v+1]>=s.value||o[v]>=m.value||n[h(o[v],o[v+1],s.value)].data>0)return!1}return!0},A=()=>{y.value||!x.value||setTimeout(()=>{if(xe()){g(l,n,s.value,"clear");for(let e=0;e<l.position.length;e+=2)l.position[e]++;g(l,n,s.value,"generate")}else g(l,n,s.value,"fix"),Fe()},0)},X=()=>{y.value||!x.value||setTimeout(()=>{if(me()){g(l,n,s.value,"clear");for(let e=0;e<l.position.length;e+=2)l.position[e+1]--;g(l,n,s.value,"generate")}},0)},Y=()=>{y.value||!x.value||setTimeout(()=>{if(pe()){g(l,n,s.value,"clear");for(let e=0;e<l.position.length;e+=2)l.position[e+1]++;g(l,n,s.value,"generate")}},0)},Z=()=>{y.value||!x.value||setTimeout(()=>{if(ye()){g(l,n,s.value,"clear");const e=l.position[0],t=l.position[1];for(let a=0;a<l.position.length;a+=2){const o=l.position[a]-e,i=l.position[a+1]-t,c=e+O[f.index][f.transform].x,v=t+O[f.index][f.transform].y;l.position[a]=i+c,l.position[a+1]=-o+v}f.transform=(f.transform+1)%4,g(l,n,s.value,"generate")}},0)},ee=(e,t,a,o)=>{g(e,t,a,"clear");for(let i=0;i<o.transform;i++){const c=e.position[0],v=e.position[1];for(let F=0;F<e.position.length;F+=2){const q=e.position[F]-c,H=e.position[F+1]-v,Q=c+O[o.index][i].x,Re=v+O[o.index][i].y;e.position[F]=H+Q,e.position[F+1]=-q+Re}}g(e,t,a,"generate")},be=e=>{S.value+=e*(e+1)/2*100*B.value},_e=()=>{j.value++,B.value=Math.max(B.value,Math.floor(j.value/fe.value)+1),R.value=V.value-(B.value-1)*de.value,R.value=Math.max(R.value,W.value),oe()},Fe=()=>{let e=0;for(let t=m.value-1;t>=0;t--){let a=0;for(let o=0;o<s.value;o++)n[h(t,o,s.value)].data>0&&a++;if(a===0)break;a===s.value&&p.push(t),e++}if(e>=m.value-U.value){P(),y.value=!0;return}if(p.length===0){J();return}x.value=!1;for(let t=0;t<K.value;t++)setTimeout(()=>{for(let a=0;a<p.length;a++)for(let o=0;o<s.value;o++){const i=h(p[a],o,s.value);n[i].flash=!n[i].flash}},t*200);setTimeout(()=>{for(let t=0;t<p.length;t++)for(let a=0;a<s.value;a++){const o=h(p[t],a,s.value);n[o].bgColor=T.value,n[o].data=0,n[o].flash=!1}for(let t=m.value-1;t>=0;t--){let a=0;for(;p[a]>t;)a++;if(a>0)for(let o=0;o<s.value;o++){const i=h(t,o,s.value);if(n[i].data>0){const c=h(t+a,o,s.value);n[c].data=n[i].data,n[c].bgColor=n[i].bgColor,n[i].data=0,n[i].bgColor=T.value}}}be(p.length),_e(),p.splice(0,p.length),x.value=!0,J()},K.value*200)},I=e=>{e&&(clearInterval(e),e=null)},we=()=>{j.value=0,B.value=0,S.value=0,R.value=V.value},te=e=>{for(let t=0;t<e.length;t++)e[t].data=0,e[t].bgColor=T.value},ae=()=>{we(),te(n),te(d),$(),J(),y.value=!1,x.value=!1,I(_.value)},oe=()=>{y.value||(x.value=!0,I(_.value),_.value=setInterval(()=>{A()},R.value))},P=()=>{y.value||(x.value?(x.value=!1,I(_.value)):oe())},ne=()=>{L.value==="lineGradientLigthTheme"?L.value="normalLightTheme":L.value="lineGradientLigthTheme"},ke=e=>{e.preventDefault(),I(_.value),_.value=setInterval(()=>{A()},W.value)},Ce=e=>{e.preventDefault(),I(_.value),_.value=setInterval(()=>{A()},R.value)},se=e=>{switch(e.key){case"ArrowUp":Z();break;case"ArrowDown":A();break;case"ArrowLeft":X();break;case"ArrowRight":Y();break;case"Enter":P();break;case"t":ne();break;case"r":ae();break}},Te=()=>{const e=localStorage.getItem("record");e&&(M.value=parseInt(e))},De=()=>{localStorage.setItem("record",M.value)};return Ee(()=>{window.addEventListener("keydown",se),ge(),he(),ve(L.value,E),Te(),$(),J(),le(L,e=>{ve(e,E)}),le(y,e=>{e&&S.value>M.value&&(M.value=S.value,De(M.value))})}),Be(()=>{window.removeEventListener("keydown",se),I(_.value)}),(e,t)=>(w(),k("div",Se,[r("div",Ae,[r("div",Ge,[(w(!0),k(re,null,ie(n.slice(s.value*U.value),(a,o)=>(w(),k("div",{key:o,class:Me(["cell",{flash:a.flash}]),style:ce(a.flash?{background:T.value,animation:`flash-bg 0.2s alternate ${K.value.value}`,"--flash-block-color":a.bgColor}:{background:a.bgColor})},[y.value?(w(),k("div",Ne,"Game Over")):Ie("",!0)],6))),128))]),r("div",je,[r("div",{class:"rotate btn",onClick:Z},"旋转"),r("div",{class:"btn",onClick:X},"向左"),r("div",{class:"btn",onClick:Y},"向右"),r("div",{class:"move-down btn",onClick:A,onTouchstart:ke,onTouchend:Ce}," 向下 ",32)])]),r("div",Je,[r("div",Pe,[(w(!0),k(re,null,ie(d,(a,o)=>(w(),k("div",{key:o,class:"cell",style:ce({background:a.bgColor})},null,4))),128))]),r("div",Ue,[r("div",ze,[t[0]||(t[0]=r("div",{class:"data-label"},"清除次数:",-1)),r("div",Ve,G(j.value),1)]),r("div",Ke,[t[1]||(t[1]=r("div",{class:"data-label"},"等级:",-1)),r("div",$e,G(B.value),1)]),r("div",qe,[t[2]||(t[2]=r("div",{class:"data-label"},"分数:",-1)),r("div",He,G(S.value),1)]),r("div",Qe,[t[3]||(t[3]=r("div",{class:"data-label"},"速度:",-1)),r("div",We,G(R.value),1)]),r("div",Xe,[t[4]||(t[4]=r("div",{class:"data-label"},"历史记录:",-1)),r("div",Ye,G(M.value),1)])]),r("div",Ze,[x.value?(w(),k("div",{key:0,class:"btn",onClick:P}," 暂停 ENTER ")):(w(),k("div",{key:1,class:"btn",onClick:P}," 开始 ENTER ")),r("div",{class:"btn",onClick:ne},"切换主题 T"),r("div",{class:"btn",onClick:ae},"重新开始 R")])])]))}},at=Le(et,[["__scopeId","data-v-adbd182a"]]);export{at as default};
